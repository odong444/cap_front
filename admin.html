<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìº¡ì±  ê´€ë¦¬ì</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: #0f0f23; color: #ccc; }
        
        .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .login-box { background: #1a1a2e; padding: 40px; border-radius: 15px; width: 350px; }
        .login-box h2 { color: #fff; margin-bottom: 25px; text-align: center; }
        .login-box input { width: 100%; padding: 12px; margin-bottom: 15px; border: none; border-radius: 8px; background: #16213e; color: #fff; }
        .login-box button { width: 100%; padding: 12px; border: none; border-radius: 8px; background: #e94560; color: #fff; cursor: pointer; }
        
        .admin-container { display: none; }
        .admin-container.active { display: flex; min-height: 100vh; }
        
        .sidebar { width: 220px; background: #1a1a2e; padding: 20px 0; }
        .sidebar h2 { color: #fff; padding: 0 20px 20px; font-size: 1.3em; }
        .sidebar a { display: block; padding: 12px 20px; color: #888; text-decoration: none; border-left: 3px solid transparent; }
        .sidebar a:hover, .sidebar a.active { background: #16213e; color: #fff; border-left-color: #e94560; }
        
        .main { flex: 1; padding: 25px; overflow-y: auto; }
        .main h2 { color: #fff; margin-bottom: 25px; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: #1a1a2e; padding: 20px; border-radius: 12px; }
        .stat-card .value { font-size: 2em; font-weight: bold; color: #e94560; }
        .stat-card .label { color: #666; margin-top: 5px; }
        
        .card { background: #1a1a2e; border-radius: 12px; margin-bottom: 20px; }
        .card-header { padding: 15px 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .card-header h3 { color: #fff; font-size: 1.1em; }
        .card-body { padding: 20px; }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #333; }
        th { color: #888; font-weight: normal; }
        
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; }
        .btn-primary { background: #e94560; color: #fff; }
        .btn-secondary { background: #333; color: #fff; }
        .btn-success { background: #10b981; color: #fff; }
        .btn-danger { background: #ef4444; color: #fff; }
        .btn-warning { background: #f59e0b; color: #fff; }
        .btn-sm { padding: 5px 10px; font-size: 12px; }
        
        .filters { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .filters input, .filters select { padding: 10px; border: none; border-radius: 6px; background: #1a1a2e; color: #fff; }
        
        .form-row { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: flex-end; }
        .form-row input, .form-row textarea { flex: 1; min-width: 150px; padding: 10px; border: none; border-radius: 6px; background: #16213e; color: #fff; }
        .form-row textarea { min-height: 100px; resize: vertical; }
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        .form-group label { font-size: 12px; color: #888; }
        
        .hidden { display: none; }
        .toast { position: fixed; bottom: 20px; right: 20px; background: #10b981; color: #fff; padding: 15px 25px; border-radius: 8px; display: none; z-index: 1000; }
        .toast.show { display: block; }
        
        .checkbox-cell { width: 30px; }
        input[type="checkbox"] { width: 16px; height: 16px; }
        
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .status-pending { background: #f59e0b; color: #000; }
        .status-collecting { background: #3b82f6; color: #fff; }
        .status-completed { background: #10b981; color: #fff; }
        
        .progress-bar { height: 6px; background: #333; border-radius: 3px; overflow: hidden; margin-top: 5px; }
        .progress-bar .fill { height: 100%; background: #10b981; transition: width 0.3s; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { padding: 10px 20px; background: #16213e; border-radius: 8px; cursor: pointer; }
        .tab.active { background: #e94560; color: #fff; }
    </style>
</head>
<body>
    <div id="login-container" class="login-container">
        <div class="login-box">
            <h2>ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
            <input type="password" id="admin-password" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸" onkeypress="if(event.keyCode==13) adminLogin()">
            <button onclick="adminLogin()">ë¡œê·¸ì¸</button>
        </div>
    </div>
    
    <div id="admin-container" class="admin-container">
        <div class="sidebar">
            <h2>âš™ï¸ ê´€ë¦¬ì</h2>
            <a href="#" class="active" onclick="showPage('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
            <a href="#" onclick="showPage('keywords')">ğŸ”‘ í‚¤ì›Œë“œ</a>
            <a href="#" onclick="showPage('results')">ğŸ“‹ ê²°ê³¼</a>
            <a href="#" onclick="showPage('users')">ğŸ‘¥ ìœ ì €</a>
            <a href="#" onclick="showPage('withdrawals')">ğŸ§ ì¶œê¸ˆ</a>
        </div>
        
        <div class="main">
            <!-- ëŒ€ì‹œë³´ë“œ -->
            <div id="page-dashboard">
                <h2>ğŸ“Š ëŒ€ì‹œë³´ë“œ</h2>
                <div class="stats-grid">
                    <div class="stat-card"><div class="value" id="stat-results">0</div><div class="label">ì´ ìˆ˜ì§‘</div></div>
                    <div class="stat-card"><div class="value" id="stat-today">0</div><div class="label">ì˜¤ëŠ˜ ìˆ˜ì§‘</div></div>
                    <div class="stat-card"><div class="value" id="stat-pending">0</div><div class="label">ëŒ€ê¸° UID</div></div>
                    <div class="stat-card"><div class="value" id="stat-users">0</div><div class="label">ìœ ì € ìˆ˜</div></div>
                </div>
            </div>
            
            <!-- í‚¤ì›Œë“œ -->
            <div id="page-keywords" class="hidden">
                <h2>ğŸ”‘ í‚¤ì›Œë“œ ê´€ë¦¬</h2>
                
                <div class="tabs">
                    <div class="tab active" onclick="showKeywordTab('single')">ë‹¨ì¼ ë“±ë¡</div>
                    <div class="tab" onclick="showKeywordTab('bulk')">ëŒ€ëŸ‰ ë“±ë¡</div>
                </div>
                
                <!-- ë‹¨ì¼ ë“±ë¡ -->
                <div id="keyword-single" class="card">
                    <div class="card-header"><h3>í‚¤ì›Œë“œ ì¶”ê°€</h3></div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group" style="flex:2">
                                <label>í‚¤ì›Œë“œ</label>
                                <input type="text" id="new-keyword" placeholder="í‚¤ì›Œë“œ ì…ë ¥">
                            </div>
                            <div class="form-group">
                                <label>ìˆ˜ì§‘ ê°œìˆ˜</label>
                                <input type="number" id="new-maxcount" value="100" style="width:100px">
                            </div>
                            <div class="form-group">
                                <label>ìš°ì„ ìˆœìœ„</label>
                                <input type="number" id="new-priority" value="0" style="width:80px">
                            </div>
                            <button class="btn btn-primary" onclick="addKeyword()">ì¶”ê°€</button>
                        </div>
                    </div>
                </div>
                
                <!-- ëŒ€ëŸ‰ ë“±ë¡ -->
                <div id="keyword-bulk" class="card hidden">
                    <div class="card-header"><h3>í‚¤ì›Œë“œ ëŒ€ëŸ‰ ë“±ë¡</h3></div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group" style="flex:3">
                                <label>í‚¤ì›Œë“œ ëª©ë¡ (ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)</label>
                                <textarea id="bulk-keywords" placeholder="ë‚¨ìì–‘ë§&#10;ì—¬ìì–‘ë§&#10;ìš´ë™í™”&#10;..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>ìˆ˜ì§‘ ê°œìˆ˜ (ê³µí†µ)</label>
                                <input type="number" id="bulk-maxcount" value="100" style="width:100px">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="bulkAddKeywords()">ëŒ€ëŸ‰ ë“±ë¡</button>
                    </div>
                </div>
                
                <!-- í‚¤ì›Œë“œ ëª©ë¡ -->
                <div class="card">
                    <div class="card-header">
                        <h3>ë“±ë¡ëœ í‚¤ì›Œë“œ</h3>
                        <button class="btn btn-sm btn-secondary" onclick="loadKeywords()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>í‚¤ì›Œë“œ</th>
                                    <th>ìƒíƒœ</th>
                                    <th>ì§„í–‰</th>
                                    <th>ìš°ì„ ìˆœìœ„</th>
                                    <th>í™œì„±í™”</th>
                                    <th>ë“±ë¡ì¼</th>
                                    <th>ì•¡ì…˜</th>
                                </tr>
                            </thead>
                            <tbody id="keywords-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ê²°ê³¼ -->
            <div id="page-results" class="hidden">
                <h2>ğŸ“‹ ìˆ˜ì§‘ ê²°ê³¼</h2>
                <div class="filters">
                    <select id="filter-used" onchange="loadResults()">
                        <option value="">ì „ì²´</option>
                        <option value="false">ë¯¸ì‚¬ìš©</option>
                        <option value="true">ì‚¬ìš©ì™„ë£Œ</option>
                    </select>
                    <input type="text" id="filter-search" placeholder="ê²€ìƒ‰" onkeypress="if(event.keyCode==13) loadResults()">
                    <button class="btn btn-primary" onclick="loadResults()">ê²€ìƒ‰</button>
                    <button class="btn btn-secondary" onclick="exportCSV()">CSV ë‚´ë³´ë‚´ê¸°</button>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3>ê²°ê³¼ ëª©ë¡</h3>
                        <div>
                            <button class="btn btn-sm btn-success" onclick="bulkUpdate(true)">ì„ íƒ ì‚¬ìš©ì™„ë£Œ</button>
                            <button class="btn btn-sm btn-secondary" onclick="bulkUpdate(false)">ì„ íƒ ë¯¸ì‚¬ìš©</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th class="checkbox-cell"><input type="checkbox" onchange="toggleAll(this)"></th>
                                    <th>ìŠ¤í† ì–´</th><th>ìƒí˜¸</th><th>ì‚¬ì—…ìë²ˆí˜¸</th><th>ëŒ€í‘œì</th><th>ì „í™”</th><th>ì‚¬ìš©</th><th>ìˆ˜ì§‘ì¼</th>
                                </tr>
                            </thead>
                            <tbody id="results-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ìœ ì € -->
            <div id="page-users" class="hidden">
                <h2>ğŸ‘¥ ìœ ì € ê´€ë¦¬</h2>
                <div class="card">
                    <div class="card-body">
                        <table>
                            <thead><tr><th>ì•„ì´ë””</th><th>í¬ì¸íŠ¸</th><th>í•´ê²°ìˆ˜</th><th>ê°€ì…ì¼</th><th>ì•¡ì…˜</th></tr></thead>
                            <tbody id="users-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ì¶œê¸ˆ -->
            <div id="page-withdrawals" class="hidden">
                <h2>ğŸ§ ì¶œê¸ˆ ê´€ë¦¬</h2>
                <div class="filters">
                    <select id="filter-wstatus" onchange="loadWithdrawals()">
                        <option value="pending">ëŒ€ê¸°ì¤‘</option>
                        <option value="completed">ì™„ë£Œ</option>
                        <option value="rejected">ê±°ì ˆ</option>
                    </select>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table>
                            <thead><tr><th>ìœ ì €</th><th>ê¸ˆì•¡</th><th>ì€í–‰</th><th>ê³„ì¢Œ</th><th>ì˜ˆê¸ˆì£¼</th><th>ì‹ ì²­ì¼</th><th>ì•¡ì…˜</th></tr></thead>
                            <tbody id="withdrawals-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="toast" class="toast"></div>
    
    <script>
        const API = 'https://capapi-production.up.railway.app';
        
        async function adminLogin() {
            const pw = document.getElementById('admin-password').value;
            const resp = await fetch(`${API}/api/admin/login`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({password: pw})
            });
            const data = await resp.json();
            
            if (data.success) {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('admin-container').classList.add('active');
                loadDashboard();
            } else {
                alert('ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜');
            }
        }
        
        function showPage(page) {
            document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('[id^="page-"]').forEach(p => p.classList.add('hidden'));
            document.getElementById('page-' + page).classList.remove('hidden');
            
            if (page === 'dashboard') loadDashboard();
            else if (page === 'keywords') loadKeywords();
            else if (page === 'results') loadResults();
            else if (page === 'users') loadUsers();
            else if (page === 'withdrawals') loadWithdrawals();
        }
        
        function showKeywordTab(tab) {
            document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('keyword-single').classList.toggle('hidden', tab !== 'single');
            document.getElementById('keyword-bulk').classList.toggle('hidden', tab !== 'bulk');
        }
        
        async function loadDashboard() {
            const resp = await fetch(`${API}/api/admin/stats`);
            const data = await resp.json();
            if (data.success) {
                document.getElementById('stat-results').textContent = data.stats.total_results;
                document.getElementById('stat-today').textContent = data.stats.today_results;
                document.getElementById('stat-pending').textContent = data.stats.pending_uids;
                document.getElementById('stat-users').textContent = data.stats.total_users;
            }
        }
        
        async function loadKeywords() {
            const resp = await fetch(`${API}/api/admin/keywords`);
            const data = await resp.json();
            const tbody = document.getElementById('keywords-table');
            
            tbody.innerHTML = data.keywords.map(k => {
                const statusClass = `status-${k.status || 'pending'}`;
                const statusText = {pending: 'ëŒ€ê¸°', collecting: 'ìˆ˜ì§‘ì¤‘', completed: 'ì™„ë£Œ'}[k.status || 'pending'];
                const progress = k.max_count > 0 ? Math.round((k.collected_count || 0) / k.max_count * 100) : 0;
                
                return `
                <tr>
                    <td><strong>${k.keyword}</strong></td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        ${k.collected_count || 0} / ${k.max_count}
                        <div class="progress-bar"><div class="fill" style="width:${progress}%"></div></div>
                    </td>
                    <td>
                        <input type="number" value="${k.priority}" style="width:60px;background:#16213e;border:none;color:#fff;padding:5px;border-radius:4px;" 
                            onchange="updateKeyword(${k.id},'priority',this.value)">
                    </td>
                    <td><input type="checkbox" ${k.is_active ? 'checked' : ''} onchange="updateKeyword(${k.id},'is_active',this.checked)"></td>
                    <td>${formatDate(k.created_at)}</td>
                    <td>
                        ${k.status === 'completed' ? `<button class="btn btn-sm btn-warning" onclick="resetKeyword(${k.id})">ë‹¤ì‹œìˆ˜ì§‘</button>` : ''}
                        <button class="btn btn-sm btn-danger" onclick="deleteKeyword(${k.id})">ì‚­ì œ</button>
                    </td>
                </tr>
            `}).join('');
        }
        
        async function addKeyword() {
            const keyword = document.getElementById('new-keyword').value.trim();
            if (!keyword) return alert('í‚¤ì›Œë“œ ì…ë ¥');
            
            await fetch(`${API}/api/admin/keywords`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    keyword,
                    priority: parseInt(document.getElementById('new-priority').value) || 0,
                    max_count: parseInt(document.getElementById('new-maxcount').value) || 100
                })
            });
            document.getElementById('new-keyword').value = '';
            toast('í‚¤ì›Œë“œ ì¶”ê°€ë¨');
            loadKeywords();
        }
        
        async function bulkAddKeywords() {
            const keywords = document.getElementById('bulk-keywords').value.trim();
            if (!keywords) return alert('í‚¤ì›Œë“œ ì…ë ¥');
            
            const resp = await fetch(`${API}/api/admin/keywords/bulk`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    keywords,
                    max_count: parseInt(document.getElementById('bulk-maxcount').value) || 100
                })
            });
            const data = await resp.json();
            
            document.getElementById('bulk-keywords').value = '';
            toast(`${data.added}ê°œ í‚¤ì›Œë“œ ì¶”ê°€ë¨`);
            loadKeywords();
        }
        
        async function updateKeyword(id, field, value) {
            const body = {};
            body[field] = field === 'is_active' ? value : parseInt(value);
            await fetch(`${API}/api/admin/keywords/${id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(body)
            });
            toast('ì—…ë°ì´íŠ¸ë¨');
        }
        
        async function resetKeyword(id) {
            if (!confirm('ë‹¤ì‹œ ìˆ˜ì§‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            await fetch(`${API}/api/collector/reset-keyword/${id}`, {method: 'POST'});
            toast('ë‹¤ì‹œ ìˆ˜ì§‘ ëŒ€ê¸° ìƒíƒœë¡œ ë³€ê²½ë¨');
            loadKeywords();
        }
        
        async function deleteKeyword(id) {
            if (!confirm('ì‚­ì œ?')) return;
            await fetch(`${API}/api/admin/keywords/${id}`, {method: 'DELETE'});
            toast('ì‚­ì œë¨');
            loadKeywords();
        }
        
        async function loadResults() {
            const used = document.getElementById('filter-used').value;
            const search = document.getElementById('filter-search').value;
            const resp = await fetch(`${API}/api/admin/results?used=${used}&search=${search}`);
            const data = await resp.json();
            
            const tbody = document.getElementById('results-table');
            tbody.innerHTML = data.results.map(r => `
                <tr>
                    <td class="checkbox-cell"><input type="checkbox" value="${r.id}"></td>
                    <td>${r.store_name || '-'}</td>
                    <td>${r.seller_name || '-'}</td>
                    <td>${r.business_number || '-'}</td>
                    <td>${r.representative || '-'}</td>
                    <td>${r.phone || '-'}</td>
                    <td><input type="checkbox" ${r.used ? 'checked' : ''} onchange="updateResult(${r.id}, this.checked)"></td>
                    <td>${formatDate(r.created_at)}</td>
                </tr>
            `).join('');
        }
        
        async function updateResult(id, used) {
            await fetch(`${API}/api/admin/results/${id}/update`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({used})
            });
        }
        
        function toggleAll(checkbox) {
            document.querySelectorAll('#results-table input[type="checkbox"]').forEach(cb => cb.checked = checkbox.checked);
        }
        
        async function bulkUpdate(used) {
            const ids = [...document.querySelectorAll('#results-table input[type="checkbox"]:checked')].map(cb => parseInt(cb.value));
            if (!ids.length) return alert('ì„ íƒëœ í•­ëª© ì—†ìŒ');
            
            await fetch(`${API}/api/admin/results/bulk-update`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ids, used})
            });
            toast(`${ids.length}ê°œ ì—…ë°ì´íŠ¸ë¨`);
            loadResults();
        }
        
        async function exportCSV() {
            const resp = await fetch(`${API}/api/admin/results/export`);
            const data = await resp.json();
            
            const headers = ['ìŠ¤í† ì–´ëª…','ìƒí˜¸ëª…','ì‚¬ì—…ìë²ˆí˜¸','ëŒ€í‘œì','ì „í™”','ì´ë©”ì¼','ì£¼ì†Œ','ìˆ˜ì§‘ì¼','ì‚¬ìš©ì—¬ë¶€'];
            const rows = data.results.map(r => [
                r.store_name, r.seller_name, r.business_number, r.representative,
                r.phone, r.email, r.address, r.created_at, r.used ? 'Y' : 'N'
            ]);
            
            const csv = [headers, ...rows].map(r => r.map(c => `"${c || ''}"`).join(',')).join('\n');
            const blob = new Blob(['\ufeff' + csv], {type: 'text/csv;charset=utf-8'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `results_${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
        }
        
        async function loadUsers() {
            const resp = await fetch(`${API}/api/admin/users`);
            const data = await resp.json();
            
            const tbody = document.getElementById('users-table');
            tbody.innerHTML = data.users.map(u => `
                <tr>
                    <td>${u.user_id}</td>
                    <td>${u.rewards.toLocaleString()}</td>
                    <td>${u.solved_count}</td>
                    <td>${formatDate(u.created_at)}</td>
                    <td><button class="btn btn-sm btn-secondary" onclick="adjustRewards('${u.user_id}')">í¬ì¸íŠ¸ ì¡°ì •</button></td>
                </tr>
            `).join('');
        }
        
        async function adjustRewards(userId) {
            const amount = prompt('ì¡°ì •í•  ê¸ˆì•¡ (ìŒìˆ˜ ê°€ëŠ¥):');
            if (!amount) return;
            
            await fetch(`${API}/api/admin/users/${userId}/adjust-rewards`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({amount: parseInt(amount), reason: 'ê´€ë¦¬ì ì¡°ì •'})
            });
            toast('í¬ì¸íŠ¸ ì¡°ì •ë¨');
            loadUsers();
        }
        
        async function loadWithdrawals() {
            const status = document.getElementById('filter-wstatus').value;
            const resp = await fetch(`${API}/api/admin/withdrawals?status=${status}`);
            const data = await resp.json();
            
            const tbody = document.getElementById('withdrawals-table');
            tbody.innerHTML = data.withdrawals.map(w => `
                <tr>
                    <td>${w.user_id}</td>
                    <td>${w.amount.toLocaleString()}</td>
                    <td>${w.bank_name || '-'}</td>
                    <td>${w.account_number || '-'}</td>
                    <td>${w.account_holder || '-'}</td>
                    <td>${formatDate(w.created_at)}</td>
                    <td>
                        ${w.status === 'pending' ? `
                            <button class="btn btn-sm btn-success" onclick="processWithdrawal(${w.id}, 'approve')">ìŠ¹ì¸</button>
                            <button class="btn btn-sm btn-danger" onclick="processWithdrawal(${w.id}, 'reject')">ê±°ì ˆ</button>
                        ` : w.status}
                    </td>
                </tr>
            `).join('');
        }
        
        async function processWithdrawal(id, action) {
            if (!confirm(`${action === 'approve' ? 'ìŠ¹ì¸' : 'ê±°ì ˆ'}?`)) return;
            
            await fetch(`${API}/api/admin/withdrawals/${id}/process`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action})
            });
            toast('ì²˜ë¦¬ ì™„ë£Œ');
            loadWithdrawals();
        }
        
        function formatDate(d) {
            if (!d) return '-';
            return new Date(d).toLocaleString('ko-KR');
        }
        
        function toast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }
        
        // ìë™ ìƒˆë¡œê³ ì¹¨ (5ì´ˆë§ˆë‹¤ í‚¤ì›Œë“œ í˜ì´ì§€)
        setInterval(() => {
            if (!document.getElementById('page-keywords').classList.contains('hidden')) {
                loadKeywords();
            }
        }, 5000);
    </script>
</body>
</html>
